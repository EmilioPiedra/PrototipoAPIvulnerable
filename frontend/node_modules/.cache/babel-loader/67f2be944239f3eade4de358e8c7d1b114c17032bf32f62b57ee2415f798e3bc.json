{"ast":null,"code":"const API_URL = \"http://localhost:4000/api\"; // Asegúrate que apunte a /api\n\n// Helper para manejar las peticiones y errores estandarizados\nconst apiCall = async (endpoint, method = \"GET\", body = null, token = null) => {\n  const headers = {\n    \"Content-Type\": \"application/json\"\n  };\n  if (token) {\n    headers[\"Authorization\"] = `Bearer ${token}`;\n  }\n  const config = {\n    method,\n    headers\n  };\n  if (body) {\n    config.body = JSON.stringify(body);\n  }\n  try {\n    const res = await fetch(`${API_URL}${endpoint}`, config);\n    const data = await res.json();\n    if (!res.ok) {\n      // Lanzamos el error que viene del backend (ej: \"Token expirado\", \"Acceso denegado\")\n      throw new Error(data.error || data.message || \"Error en la petición\");\n    }\n    return data;\n  } catch (error) {\n    throw error;\n  }\n};\n\n// ==========================================\n// 1. AUTENTICACIÓN (LOGIN 2FA)\n// ==========================================\n\n// Paso 1: Enviar credenciales -> Recibir tempToken\nexport const loginStep1 = async (usuario, password) => {\n  return await apiCall(\"/auth/login\", \"POST\", {\n    usuario,\n    password\n  });\n};\n\n// Paso 2: Enviar tempToken + OTP -> Recibir Token Final\nexport const loginStep2 = async (tempToken, otp) => {\n  return await apiCall(\"/auth/login/verify\", \"POST\", {\n    tempToken,\n    otp\n  });\n};\n\n// Verificar Token / Obtener Perfil (Ruta protegida base)\nexport const fetchProtectedData = async token => {\n  return await apiCall(\"/otp/protected\", \"GET\", null, token);\n};\n\n// ==========================================\n// 2. RECUPERACIÓN DE CONTRASEÑA\n// ==========================================\n\nexport const requestPasswordReset = async usuario => {\n  return await apiCall(\"/otp/request-otp\", \"POST\", {\n    usuario\n  });\n};\nexport const verifyPasswordResetOtp = async (usuario, otp) => {\n  return await apiCall(\"/otp/verify-otp\", \"POST\", {\n    usuario,\n    otp\n  });\n};\nexport const changePassword = async (usuario, otp, nuevaPassword) => {\n  return await apiCall(\"/otp/change-password\", \"POST\", {\n    usuario,\n    otp,\n    nuevaPassword\n  });\n};\n\n// ==========================================\n// 3. ADMINISTRACIÓN (Solo Admin)\n// ==========================================\n\nexport const getUsers = async token => {\n  return await apiCall(\"/users\", \"GET\", null, token);\n};\nexport const updateUserAdmin = async (token, usuarioTarget, data) => {\n  return await apiCall(`/actualizar/${usuarioTarget}`, \"PUT\", data, token);\n};\nexport const deleteUserAdmin = async (token, usuarioTarget) => {\n  return await apiCall(`/eliminar/${usuarioTarget}`, \"DELETE\", null, token);\n};\n\n// ==========================================\n// 4. INVENTARIO\n// ==========================================\n\nexport const getInventario = async token => {\n  return await apiCall(\"/inventario\", \"GET\", null, token);\n};\nexport const addInventario = async (token, itemData) => {\n  return await apiCall(\"/addInventario\", \"POST\", itemData, token);\n};\n\n// ==========================================\n// 5. PERFIL DE USUARIO (Anti-IDOR)\n// ==========================================\n\nexport const getUserProfile = async (token, id) => {\n  return await apiCall(`/user/${id}`, \"GET\", null, token);\n};\nexport const updateUserProfile = async (token, id, data) => {\n  // data debería ser { correo, telefono } solamente\n  return await apiCall(`/user/${id}`, \"PUT\", data, token);\n};","map":{"version":3,"names":["API_URL","apiCall","endpoint","method","body","token","headers","config","JSON","stringify","res","fetch","data","json","ok","Error","error","message","loginStep1","usuario","password","loginStep2","tempToken","otp","fetchProtectedData","requestPasswordReset","verifyPasswordResetOtp","changePassword","nuevaPassword","getUsers","updateUserAdmin","usuarioTarget","deleteUserAdmin","getInventario","addInventario","itemData","getUserProfile","id","updateUserProfile"],"sources":["C:/Users/reale/Desktop/Ataques/jwt-login-node/frontend/src/services/api.js"],"sourcesContent":["const API_URL = \"http://localhost:4000/api\"; // Asegúrate que apunte a /api\r\n\r\n// Helper para manejar las peticiones y errores estandarizados\r\nconst apiCall = async (endpoint, method = \"GET\", body = null, token = null) => {\r\n  const headers = { \"Content-Type\": \"application/json\" };\r\n  \r\n  if (token) {\r\n    headers[\"Authorization\"] = `Bearer ${token}`;\r\n  }\r\n\r\n  const config = {\r\n    method,\r\n    headers,\r\n  };\r\n\r\n  if (body) {\r\n    config.body = JSON.stringify(body);\r\n  }\r\n\r\n  try {\r\n    const res = await fetch(`${API_URL}${endpoint}`, config);\r\n    const data = await res.json();\r\n\r\n    if (!res.ok) {\r\n      // Lanzamos el error que viene del backend (ej: \"Token expirado\", \"Acceso denegado\")\r\n      throw new Error(data.error || data.message || \"Error en la petición\");\r\n    }\r\n    return data;\r\n  } catch (error) {\r\n    throw error;\r\n  }\r\n};\r\n\r\n// ==========================================\r\n// 1. AUTENTICACIÓN (LOGIN 2FA)\r\n// ==========================================\r\n\r\n// Paso 1: Enviar credenciales -> Recibir tempToken\r\nexport const loginStep1 = async (usuario, password) => {\r\n  return await apiCall(\"/auth/login\", \"POST\", { usuario, password });\r\n};\r\n\r\n// Paso 2: Enviar tempToken + OTP -> Recibir Token Final\r\nexport const loginStep2 = async (tempToken, otp) => {\r\n  return await apiCall(\"/auth/login/verify\", \"POST\", { tempToken, otp });\r\n};\r\n\r\n// Verificar Token / Obtener Perfil (Ruta protegida base)\r\nexport const fetchProtectedData = async (token) => {\r\n  return await apiCall(\"/otp/protected\", \"GET\", null, token);\r\n};\r\n\r\n// ==========================================\r\n// 2. RECUPERACIÓN DE CONTRASEÑA\r\n// ==========================================\r\n\r\nexport const requestPasswordReset = async (usuario) => {\r\n  return await apiCall(\"/otp/request-otp\", \"POST\", { usuario });\r\n};\r\n\r\nexport const verifyPasswordResetOtp = async (usuario, otp) => {\r\n  return await apiCall(\"/otp/verify-otp\", \"POST\", { usuario, otp });\r\n};\r\n\r\nexport const changePassword = async (usuario, otp, nuevaPassword) => {\r\n  return await apiCall(\"/otp/change-password\", \"POST\", { usuario, otp, nuevaPassword });\r\n};\r\n\r\n// ==========================================\r\n// 3. ADMINISTRACIÓN (Solo Admin)\r\n// ==========================================\r\n\r\nexport const getUsers = async (token) => {\r\n  return await apiCall(\"/users\", \"GET\", null, token);\r\n};\r\n\r\nexport const updateUserAdmin = async (token, usuarioTarget, data) => {\r\n  return await apiCall(`/actualizar/${usuarioTarget}`, \"PUT\", data, token);\r\n};\r\n\r\nexport const deleteUserAdmin = async (token, usuarioTarget) => {\r\n  return await apiCall(`/eliminar/${usuarioTarget}`, \"DELETE\", null, token);\r\n};\r\n\r\n// ==========================================\r\n// 4. INVENTARIO\r\n// ==========================================\r\n\r\nexport const getInventario = async (token) => {\r\n  return await apiCall(\"/inventario\", \"GET\", null, token);\r\n};\r\n\r\nexport const addInventario = async (token, itemData) => {\r\n  return await apiCall(\"/addInventario\", \"POST\", itemData, token);\r\n};\r\n\r\n// ==========================================\r\n// 5. PERFIL DE USUARIO (Anti-IDOR)\r\n// ==========================================\r\n\r\nexport const getUserProfile = async (token, id) => {\r\n  return await apiCall(`/user/${id}`, \"GET\", null, token);\r\n};\r\n\r\nexport const updateUserProfile = async (token, id, data) => {\r\n  // data debería ser { correo, telefono } solamente\r\n  return await apiCall(`/user/${id}`, \"PUT\", data, token);\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}